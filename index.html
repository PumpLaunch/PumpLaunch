<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PumpLaunch ‚Äî Token + Raydium Auto Pool</title>

  <!-- Tailwind + Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Librairies Solana / Raydium / NFT.storage -->
  <script src="https://unpkg.com/@solana/web3.js@1.91.7/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@0.4.8/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@metaplex-foundation/umi@0.8.10/dist/index.iife.js"></script>
  <script src="https://unpkg.com/@metaplex-foundation/umi-bundle-defaults@0.8.10/dist/index.iife.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nft.storage@7.1.1/dist/index.min.js"></script>
  <script src="https://unpkg.com/@raydium/sdk@latest/dist/raydium-sdk.min.js"></script>

  <style>
    html, body { font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    
    /* Animated Background */
    .animated-gradient-bg {
      background: linear-gradient(-45deg, #0a0a0a, #1a1a2e, #16213e, #0f3460);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Glassmorphism Card */
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Custom Spinner */
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid white;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen animated-gradient-bg text-white font-inter flex flex-col">

  <!-- Header -->
  <header class="py-8 text-center border-b border-gray-800 relative z-10">
    <h1 class="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400">
      üöÄ PumpLaunch
    </h1>
    <p class="text-gray-400 mt-4 text-lg md:text-xl max-w-2xl mx-auto px-4">
      L'outil ultime pour cr√©er votre token Solana et le lancer avec un pool de liquidit√© sur Raydium, en toute simplicit√©.
    </p>
  </header>

  <!-- Main Content -->
  <main class="flex-grow flex items-center justify-center px-4 py-12 relative z-10">
    <div class="w-full max-w-xl">
      
      <!-- Connexion Phantom -->
      <section id="walletSection" class="glass-card p-8 rounded-2xl shadow-2xl mb-8">
        <button id="connectButton" type="button" class="w-full py-4 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
          <i class="fab fa-phantom mr-2"></i> Se connecter avec Phantom
        </button>
        <div id="status" class="mt-4 text-center text-gray-300 text-base"></div>
        <div id="wallet-info" class="mt-2 text-green-400 font-mono text-sm break-all bg-black bg-opacity-30 p-3 rounded-lg text-center"></div>
      </section>

      <!-- Formulaire Token -->
      <section id="tokenFormSection" class="glass-card p-8 rounded-2xl shadow-2xl">
        <form id="tokenForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-tag mr-2"></i>Nom du Token</label>
            <input type="text" name="name" class="w-full p-3 rounded-lg bg-gray-800 bg-opacity-50 border border-gray-600 text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all" required/>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-coins mr-2"></i>Symbole</label>
            <input type="text" name="symbol" class="w-full p-3 rounded-lg bg-gray-800 bg-opacity-50 border border-gray-600 text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all" required/>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-align-left mr-2"></i>Description</label>
            <textarea name="description" rows="3" class="w-full p-3 rounded-lg bg-gray-800 bg-opacity-50 border border-gray-600 text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all"></textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2"><i class="fab fa-solana mr-2"></i>Montant SOL</label>
              <input type="number" id="solAmount" class="w-full p-3 rounded-lg bg-gray-800 bg-opacity-50 border border-gray-600 text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all" step="0.01" required/>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2"><i class="fas fa-percentage mr-2"></i>% Supply en liquidit√©</label>
              <input type="number" id="percentSupply" class="w-full p-3 rounded-lg bg-gray-800 bg-opacity-50 border border-gray-600 text-white focus:border-purple-500 focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 transition-all" step="0.1" required/>
            </div>
          </div>
          <button type="submit" class="w-full py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
            <i class="fas fa-rocket mr-2"></i> Cr√©er le Token + Pool
          </button>
        </form>
      </section>
    </div>
  </main>

  <!-- Loading / Success -->
  <section id="loading" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="text-center p-8 glass-card rounded-2xl">
      <div class="spinner mx-auto mb-4"></div>
      <p class="text-yellow-400 text-xl font-semibold">‚è≥ Cr√©ation en cours...</p>
    </div>
  </section>
  <section id="success" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="text-center p-8 glass-card rounded-2xl max-w-md">
      <i class="fas fa-check-circle text-green-400 text-6xl mb-4"></i>
      <p class="text-green-400 font-bold text-2xl mb-2">‚úÖ Succ√®s !</p>
      <p class="text-gray-300 mb-4">Votre token et votre pool ont √©t√© cr√©√©s.</p>
      <div class="text-left space-y-2">
        <p class="text-sm"><strong>Mint:</strong> <span id="mintAddr" class="font-mono text-xs break-all"></span></p>
        <p class="text-sm"><strong>Pool:</strong> <span id="poolAddr" class="font-mono text-xs break-all"></span></p>
      </div>
      <div class="mt-6 flex flex-wrap justify-center gap-4">
        <a id="solscan" target="_blank" class="text-blue-400 underline hover:text-blue-300"><i class="fas fa-search mr-1"></i>Solscan</a>
        <a id="dexscreener" target="_blank" class="text-blue-400 underline hover:text-blue-300"><i class="fas fa-chart-line mr-1"></i>Dexscreener</a>
        <a id="raydium" target="_blank" class="text-blue-400 underline hover:text-blue-300"><i class="fas fa-exchange-alt mr-1"></i>Raydium Swap</a>
      </div>
       <button onclick="location.reload()" class="mt-6 px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-bold transition-all">
        Cr√©er un autre token
      </button>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-6 text-center text-gray-500 text-sm border-t border-gray-800 relative z-10">
    <p>&copy; 2024 PumpLaunch. Tous droits r√©serv√©s.</p>
    <p class="mt-2">Propuls√© par <a href="https://solana.com" target="_blank" class="text-purple-400 hover:underline">Solana</a> & <a href="https://raydium.io/" target="_blank" class="text-purple-400 hover:underline">Raydium</a>.</p>
  </footer>

  <!-- Scripts -->
  <script type="module">
    import nacl from "https://cdn.skypack.dev/tweetnacl";
    import bs58 from "https://cdn.skypack.dev/bs58";

    // --- CONFIGURATION ---
    const TON_ADRESSE = "EFYHSL789UeZwyDwgRcUhJYiU3GygoaBuDz2JfhHcMLr";
    const FRAIS_SERVICE = 0.05 * 1e9; // 0.05 SOL
    const NFT_STORAGE_API_KEY = "VOTRE_CL√â_NFT_STORAGE_ICI"; // Remplacez par votre vraie cl√©

    const SOL_TOKEN_MINT = 'So11111111111111111111111111111111111111112'; // WSOL
    const METADATA_PROGRAM_ID = 'metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s';

    let provider = null;
    let connection = null;
    let network = "mainnet-beta";
    let raydium = null;

    // --- FONCTIONS PRINCIPALES ---
    async function initConnection() {
      connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl(network), 'confirmed');
      try {
        raydium = await window.Raydium.load({
          owner: provider.publicKey,
          connection,
          cluster: network,
          disableFeatureCheck: true,
          disableLoadCache: true,
          blockhashCommitment: 'finalized',
        });
        console.log("SDK Raydium initialis√© avec succ√®s.");
      } catch (e) {
        console.error("Erreur lors de l'initialisation du SDK Raydium:", e);
        alert("Le SDK Raydium n'a pas pu se charger. Certaines fonctionnalit√©s pourraient ne pas fonctionner.");
      }
    }

    async function createTokenWithMetadata(tokenInfo, owner) {
      if (!NFT_STORAGE_API_KEY || NFT_STORAGE_API_KEY === "VOTRE_CL√â_NFT_STORAGE_ICI") {
        throw new Error("La cl√© API NFT.Storage n'est pas configur√©e.");
      }
      const metadata = { name: tokenInfo.name, symbol: tokenInfo.symbol, description: tokenInfo.description, image: tokenInfo.imageUri };
      const client = new NFTStorage({ token: NFT_STORAGE_API_KEY });
      const metadataCid = await client.storeBlob(new Blob([JSON.stringify(metadata)]));
      const metadataUri = `https://ipfs.io/ipfs/${metadataCid}`;
      console.log("M√©tadonn√©es t√©l√©charg√©es sur IPFS :", metadataUri);

      const mintKeypair = solanaWeb3.Keypair.generate();
      const decimals = 9;
      const [metadataPDA, _] = await solanaWeb3.PublicKey.findProgramAddress(
        [Buffer.from("metadata"), new solanaWeb3.PublicKey(METADATA_PROGRAM_ID).toBuffer(), mintKeypair.publicKey.toBuffer()],
        new solanaWeb3.PublicKey(METADATA_PROGRAM_ID)
      );
      
      const createMintAndMetadataTx = new solanaWeb3.Transaction();
      createMintAndMetadataTx.add(
        splToken.createCreateMetadataAccountV2Instruction({ metadata: metadataPDA, mint: mintKeypair.publicKey, mintAuthority: owner, payer: owner, updateAuthority: owner }, { createMetadataAccountArgsV2: { data: { name: tokenInfo.name, symbol: tokenInfo.symbol, uri: metadataUri, sellerFeeBasisPoints: 0, creators: null, collection: null, uses: null }, isMutable: true } }),
        splToken.createInitializeMintInstruction(mintKeypair.publicKey, decimals, owner, owner)
      );
      
      const { blockhash } = await connection.getLatestBlockhash();
      createMintAndMetadataTx.recentBlockhash = blockhash;
      createMintAndMetadataTx.feePayer = owner;
      const signedTx = await provider.signTransaction(createMintAndMetadataTx);
      signedTx.partialSign(mintKeypair);
      const txId = await connection.sendRawTransaction(signedTx.serialize());
      await connection.confirmTransaction(txId);
      console.log("Token et m√©tadonn√©es cr√©√©s ! TxID:", txId);
      return mintKeypair.publicKey;
    }

    async function mintTokens(mint, destination, amount) {
      const amountLamports = amount * Math.pow(10, 9);
      const associatedTokenAccount = await splToken.getOrCreateAssociatedTokenAccount(connection, provider.publicKey, mint, destination);
      const transaction = new solanaWeb3.Transaction().add(splToken.createMintToInstruction(mint, associatedTokenAccount.address, provider.publicKey, amountLamports));
      const { blockhash } = await connection.getLatestBlockhash();
      transaction.recentBlockhash = blockhash;
      transaction.feePayer = provider.publicKey;
      const signedTx = await provider.signTransaction(transaction);
      const txId = await connection.sendRawTransaction(signedTx.serialize());
      await connection.confirmTransaction(txId);
      console.log(`${amount} tokens mint√©s vers ${destination.toString()}. TxID:`, txId);
    }

    async function createAndFundRaydiumPool(tokenMintA, tokenMintB, amountA, amountB) {
      if (!raydium) throw new Error("Le SDK Raydium n'est pas initialis√©.");
      const { execute: executeCreate, extInfo: extInfoCreate } = await raydium.liquidity.createPool({ poolInfo: { tokenA: tokenMintA, tokenB: tokenMintB, fee: 0.0025 } });
      const { txId: txIdCreate } = await executeCreate({ sendAndConfirm: true });
      console.log("Pool Raydium cr√©√©. TxID:", txIdCreate);
      const poolId = extInfoCreate.poolId;
      const { execute: executeAdd } = await raydium.liquidity.addLiquidity({ poolInfo: await raydium.api.fetchPoolById({ ids: poolId }), amountInA, amountInB, fixedSide: 'a' });
      const { txId: txIdAdd } = await executeAdd({ sendAndConfirm: true });
      console.log("Liquidit√© ajout√©e. TxID:", txIdAdd);
      return { poolId, txId: txIdAdd };
    }

    async function collectServiceFee() {
      const transferInstruction = solanaWeb3.SystemProgram.transfer({ fromPubkey: provider.publicKey, toPubkey: new solanaWeb3.PublicKey(TON_ADRESSE), lamports: FRAIS_SERVICE });
      const feeTransaction = new solanaWeb3.Transaction().add(transferInstruction);
      const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();
      feeTransaction.recentBlockhash = blockhash;
      feeTransaction.feePayer = provider.publicKey;
      const signedFeeTransaction = await provider.signTransaction(feeTransaction);
      const txId = await connection.sendRawTransaction(signedFeeTransaction.serialize(), { skipPreflight: false, preflightCommitment: 'confirmed' });
      const confirmation = await connection.confirmTransaction({ blockhash, lastValidBlockHeight, signature: txId }, 'confirmed');
      if (confirmation.value.err) throw new Error(`La transaction de frais a √©chou√© : ${confirmation.value.err}`);
      console.log(`Frais de service de ${FRAIS_SERVICE / 1e9} SOL transf√©r√©s. TxID: ${txId}`);
      return txId;
    }

    // --- GESTIONNAIRES D'√âV√âNEMENTS ---
    function isMobile() { return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }
    function currentPageUrl() { return window.location.origin + window.location.pathname; }
    
    async function handlePhantomReturn() {
      const params = new URLSearchParams(window.location.search);
      const phantomPubKeyB58 = params.get("phantom_encryption_public_key");
      const dataB64 = params.get("data");
      const nonceB64 = params.get("nonce");
      if (!phantomPubKeyB58 || !dataB64 || !nonceB64) return;
      const statusDiv = document.getElementById('status');
      const walletInfoDiv = document.getElementById('wallet-info');
      statusDiv.innerText = "‚úÖ Wallet connect√© via Phantom (retour)";
      const dappSecretKeyB58 = sessionStorage.getItem("dappSecretKeyBase58");
      if (!dappSecretKeyB58) { walletInfoDiv.innerText = "‚ö†Ô∏è Cl√© secr√®te introuvable (rappuie sur le bouton pour relancer)"; return; }
      const dappSecretKey = bs58.decode(dappSecretKeyB58);
      const phantomPublicKey = bs58.decode(phantomPubKeyB58);
      const data = Uint8Array.from(atob(dataB64), c => c.charCodeAt(0));
      const nonce = Uint8Array.from(atob(nonceB64), c => c.charCodeAt(0));
      const decrypted = nacl.box.open(data, nonce, phantomPublicKey, dappSecretKey);
      if (!decrypted) { walletInfoDiv.innerText = "‚ùå Impossible de d√©chiffrer le message de Phantom"; return; }
      const payloadStr = new TextDecoder().decode(decrypted);
      try {
        const payload = JSON.parse(payloadStr);
        walletInfoDiv.innerText = `Adresse: ${payload.public_key}`;
        window.provider = { publicKey: new solanaWeb3.PublicKey(payload.public_key), signTransaction: async (tx) => { throw new Error("signTransaction non impl√©ment√© pour mobile deep link"); }, signAllTransactions: async (txs) => { throw new Error("signAllTransactions non impl√©ment√© pour mobile deep link"); } };
        await initConnection();
      } catch (e) { console.warn("Impossible d'initialiser provider mobile:", e); }
      window.history.replaceState({}, document.title, currentPageUrl());
    }

    function connectMobile() {
      const statusDiv = document.getElementById('status');
      statusDiv.innerText = "üì± Redirection vers l'app Phantom...";
      const keyPair = nacl.box.keyPair();
      const dappPublicKeyB58 = bs58.encode(keyPair.publicKey);
      const dappSecretKeyB58 = bs58.encode(keyPair.secretKey);
      sessionStorage.setItem("dappSecretKeyBase58", dappSecretKeyB58);
      const appUrl = encodeURIComponent(currentPageUrl());
      const redirectLink = encodeURIComponent(currentPageUrl());
      const deepLink = `https://phantom.app/ul/v1/connect?dapp_encryption_public_key=${dappPublicKeyB58}&app_url=${appUrl}&redirect_link=${redirectLink}&cluster=mainnet-beta`;
      window.location.replace(deepLink);
    }

    async function connectDesktop() {
      const statusDiv = document.getElementById('status');
      const walletInfoDiv = document.getElementById('wallet-info');
      statusDiv.innerText = "Tentative de connexion via extension...";
      try {
        if (window.solana && window.solana.isPhantom) {
          const resp = await window.solana.connect();
          statusDiv.innerText = "‚úÖ Connect√© via extension";
          walletInfoDiv.innerText = resp.publicKey.toString();
          window.provider = window.solana;
          await initConnection();
        } else {
          statusDiv.innerText = "‚ùå Extension Phantom non d√©tect√©e (installez Phantom ou utilisez l'app sur mobile)";
        }
      } catch (err) {
        console.error("connectDesktop error:", err);
        statusDiv.innerText = "Erreur: " + (err?.message || err);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const connectBtn = document.getElementById('connectButton');
      const statusDiv = document.getElementById('status');
      const walletInfoDiv = document.getElementById('wallet-info');
      const tokenFormSection = document.getElementById('tokenFormSection');
      
      if (!connectBtn) { console.warn("connectButton introuvable"); return; }

      function onConnectClick(e) {
        e.preventDefault();
        if (isMobile()) { connectMobile(); } else { connectDesktop(); }
      }
      connectBtn.addEventListener('click', onConnectClick, { passive: false });
      connectBtn.addEventListener('touchstart', onConnectClick, { passive: false });
      handlePhantomReturn();

      document.getElementById("tokenForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!provider?.publicKey) { statusDiv.innerText = "‚ùå Veuillez connecter votre portefeuille d'abord."; return; }
        const formData = new FormData(e.target);
        const tokenInfo = { name: formData.get('name'), symbol: formData.get('symbol'), description: formData.get('description'), imageUri: "https://via.placeholder.com/150" };
        const solAmount = parseFloat(document.getElementById('solAmount').value);
        const percentSupply = parseFloat(document.getElementById('percentS
